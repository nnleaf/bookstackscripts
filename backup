#!/bin/bash
#     ////     //  ////     //
#    // //    //  // //    //
#   //  //   //  //  //   //
#  //   //  //  //   //  //
# //    // //  //    // //
#//     ////  //     ////
#
# 20200407 - BookStack Backup
echo "------------------------------------------------------------------------"
echo "Backing up MariaSQL database..."
echo "------------------------------------------------------------------------"
mysqldump -u nn nnserver > BookStack.sql
cp BookStack.sql /home/nn/bookstack_backup/BookStack.sql
echo "------------------------------------------------------------------------"
echo "Creating archive of files to backup..."
echo "------------------------------------------------------------------------"
tar -czvf /home/nn/bookstack_backup/bookstack-files-backup.tar.gz /var/www/html/BookStack/.env /var/www/html/BookStack/public/uploads /var/www/html/BookStack/storage/uploads
echo "------------------------------------------------------------------------"
echo "Creating archive of BookStack folder to backup..."
echo "------------------------------------------------------------------------"
tar -czvf /home/nn/bookstack_backup/bookstack-complete-backup.tar.gz /var/www/html/BookStack
echo "------------------------------------------------------------------------"
echo "Backing up bookstack_backup to vault"
echo "------------------------------------------------------------------------"
#Mounts vault, copies bookstack_backup with date stamp, unmounts
sudo mount -t cifs //192.168.1.111/n1 /mnt/tmp -o credentials=/home/nn/Keys/.vaultpassword
sudo cp -r /home/nn/bookstack_backup/ /mnt/tmp/Files/ComputerFiles/2.Linux/Debian/HOME10.BookStack\ 192.168.1.112/Backup/bookstack_backup_"$(date +%Y-%m-%d_%H%M%S)"/
sudo umount -t cifs //192.168.1.111/n1